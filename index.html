<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Stream</title>

<style>
:root{--bg:#05060f;--panel:#0b1020;--accent:#3b82f6;--text:#e5e7eb;--muted:#9ca3af}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui}
.wrap{max-width:720px;margin:auto;padding:14px}
.card{background:linear-gradient(180deg,#0b1020,#060814);border-radius:14px;padding:14px}
.hidden{display:none}
h1{font-size:18px;margin:6px 0}
.stats{display:flex;gap:16px;font-size:12px;color:var(--muted)}
.online{display:flex;align-items:center;gap:6px}
.dot{width:8px;height:8px;border-radius:50%;background:#22ff00;opacity:.2}
.dot.on{animation:blink 1.2s infinite}
@keyframes blink{50%{opacity:1}}
video,iframe{width:100%;border-radius:14px;background:#000;margin:12px 0;height:420px}
.controls{display:flex;justify-content:center;gap:14px;flex-wrap:wrap}
.ctrl{width:40px;height:40px;border-radius:10px;background:#111827;display:flex;align-items:center;justify-content:center;cursor:pointer}
select{width:40px;height:40px;background:#111827;border:1px solid #1f2937;color:#fff;border-radius:10px;text-align:center}
.full-btn{width:100%;margin-top:14px;padding:14px;border-radius:12px;background:#111827;border:1px solid #1f2937;color:#fff;font-weight:600;cursor:pointer}
</style>
</head>

<body>

<div class="wrap">
<div id="app" class="card hidden">

<h1 id="title"></h1>

<div class="stats">
<div id="views">0 views</div>
<div class="online">
<div id="dot" class="dot"></div>
<span id="onlineText">0 online</span>
</div>
</div>

<div id="videoWrap" style="position:relative">
<video id="player" playsinline controls></video>
<button id="playOverlay"
style="position:absolute;inset:0;margin:auto;width:80px;height:80px;border-radius:50%;border:none;font-size:26px;background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;cursor:pointer;">
▶
</button>
</div>

<div class="controls">
<div id="fs" class="ctrl">⛶</div>
<div id="rewind" class="ctrl">⏪</div>
<div id="forward" class="ctrl">⏩</div>
<select id="speed">
<option value="1">1x</option>
<option value="1.25">1.25x</option>
<option value="1.5">1.5x</option>
<option value="2">2x</option>
</select>
</div>

</div>
</div>

<script>
const FIREBASE='https://views-counter-610fa-default-rtdb.asia-southeast1.firebasedatabase.app';
const id=new URLSearchParams(location.search).get('v');
let player=document.getElementById('player');

/* ===== PLAYER BUILDER ===== */
function createPlayer(){
const wrap=document.getElementById('videoWrap');
wrap.innerHTML=`
<video id="player" playsinline controls style="width:100%;height:420px;border-radius:14px;background:#000"></video>
<button id="playOverlay" style="position:absolute;inset:0;margin:auto;width:80px;height:80px;border-radius:50%;border:none;font-size:26px;background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;cursor:pointer;">▶</button>
`;
player=document.getElementById('player');
const overlay=document.getElementById('playOverlay');

overlay.onclick=()=>player.play();
player.onplay=()=>overlay.style.display="none";
player.onpause=()=>overlay.style.display="block";
}

/* ===== LOAD VIDEO ===== */
function playVideo(url){
createPlayer();

if(url.includes("streamtape.com")){
const m=url.match(/\/v\/([^\/]+)/);
if(m) url="https://streamtape.com/get_video?id="+m[1];
}

if(url.includes("videy.co")){
const m=url.match(/id=([^&]+)/);
if(m) url="https://cdn.videy.co/"+m[1]+".mp4";
}

player.src=url;
}

/* ===== LOAD DATA ===== */
fetch('/videos')
.then(r=>r.json())
.then(videos=>{
if(!id||!videos[id]) return;

const v=videos[id];
document.getElementById('app').classList.remove('hidden');
document.getElementById('title').textContent=v.title;

playVideo(v.src);

document.getElementById('rewind').onclick=()=>player.currentTime-=5;
document.getElementById('forward').onclick=()=>player.currentTime+=5;
document.getElementById('fs').onclick=()=>!document.fullscreenElement?player.requestFullscreen():document.exitFullscreen();
document.getElementById('speed').onchange=e=>player.playbackRate=parseFloat(e.target.value);

/* ===== VIEWS ===== */
fetch(`${FIREBASE}/views/${id}.json`)
.then(r=>r.json())
.then(d=>{
fetch(`${FIREBASE}/views/${id}.json`,{
method:'PUT',
body:JSON.stringify((typeof d==='number'?d:0)+1)
});
});

setInterval(()=>{
fetch(`${FIREBASE}/views/${id}.json`)
.then(r=>r.json())
.then(d=>views.textContent=(typeof d==='number'?d:0)+' views');
},3000);

/* ===== ONLINE ===== */
const sid=Math.random().toString(36).slice(2);
setInterval(()=>{
fetch(`${FIREBASE}/online/${id}/${sid}.json`,{method:'PUT',body:Date.now()});
fetch(`${FIREBASE}/online/${id}.json`)
.then(r=>r.json())
.then(d=>{
let c=0,now=Date.now();
for(let k in d) if(now-d[k]<10000) c++;
onlineText.textContent=c+' online';
dot.classList.toggle('on',c>0);
});
},4000);

});

/* ===== WAJIB 3 IKLAN SEBELUM PLAY ===== */
(function(){
let adCount=0;
document.addEventListener('click',function(e){
const wrap=document.getElementById('videoWrap');
if(!wrap) return;
if(!wrap.contains(e.target)) return;

if(adCount<3){
e.preventDefault();
e.stopPropagation();
window.open('https://omg10.com/4/9707196','_blank');
adCount++;
return false;
}
},true);
})();
</script>

<!-- POPUNDER ZONE -->
<script>
(function(s){
s.dataset.zone='9713245';
s.src='https://al5sm.com/tag.min.js';
})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')));
</script>

</body>
</html>
