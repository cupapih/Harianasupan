<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Stream</title>

<style>
:root{--bg:#05060f;--panel:#0b1020;--accent:#3b82f6;--text:#e5e7eb;--muted:#9ca3af}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui}
.wrap{max-width:720px;margin:auto;padding:14px}
.card{background:linear-gradient(180deg,#0b1020,#060814);border-radius:14px;padding:14px}
.hidden{display:none}
h1{font-size:18px;margin:6px 0}
.stats{display:flex;gap:16px;font-size:12px;color:var(--muted)}
.online{display:flex;align-items:center;gap:6px}
.dot{width:8px;height:8px;border-radius:50%;background:#22ff00;opacity:.2}
.dot.on{animation:blink 1.2s infinite}
@keyframes blink{50%{opacity:1}}
video,iframe{width:100%;border-radius:14px;background:#000;margin:12px 0;height:420px}
.controls{display:flex;justify-content:center;gap:14px;flex-wrap:wrap}
.ctrl{width:40px;height:40px;border-radius:10px;background:#111827;display:flex;align-items:center;justify-content:center;cursor:pointer}
select{width:40px;height:40px;background:#111827;border:1px solid #1f2937;color:#fff;border-radius:10px;text-align:center}
.full-btn{width:100%;margin-top:14px;padding:14px;border-radius:12px;background:#111827;border:1px solid #1f2937;color:#fff;font-weight:600;cursor:pointer}
.popup{position:fixed;inset:0;display:none;justify-content:center;align-items:flex-end;z-index:999}
.popup.show{display:flex}
.popup-bg{position:absolute;inset:0;background:rgba(0,0,0,.6)}
.popup-box{position:relative;width:95%;max-width:520px;max-height:70vh;background:#0b1020;border-radius:16px 16px 0 0;padding:16px;overflow-y:auto}
</style>
</head>

<body>

<div class="wrap">
<div id="app" class="card hidden">
<h1 id="title"></h1>

<div class="stats">
<div id="views">0 views</div>
<div class="online">
<div id="dot" class="dot"></div>
<span id="onlineText">0 online</span>
</div>
</div>

<div id="videoWrap" style="position:relative">
<video id="player" playsinline controls></video>
<button id="playOverlay"
style="
position:absolute;
inset:0;
margin:auto;
width:80px;
height:80px;
border-radius:50%;
border:none;
font-size:26px;
background:linear-gradient(135deg,#3b82f6,#2563eb);
color:#fff;
cursor:pointer;">
▶
</button>
</div>

<div class="controls">
<div id="fs" class="ctrl">⛶</div>
<div id="rewind" class="ctrl">⏪</div>
<div id="forward" class="ctrl">⏩</div>
<select id="speed">
<option value="1">1x</option>
<option value="1.25">1.25x</option>
<option value="1.5">1.5x</option>
<option value="2">2x</option>
</select>
</div>

<button id="openFull" class="full-btn">FULL KONTEN</button>
</div>
</div>

<div id="popup" class="popup">
<div class="popup-bg"></div>
<div class="popup-box" id="popupBox"></div>
</div>

<script>
const FIREBASE='https://views-counter-610fa-default-rtdb.asia-southeast1.firebasedatabase.app';
const id=new URLSearchParams(location.search).get('v');
let player=document.getElementById('player');

function createOverlayPlayer(){
const wrap=document.getElementById('videoWrap');

const newPlayer=document.createElement("video");
newPlayer.id="player";
newPlayer.controls=true;
newPlayer.playsInline=true;
newPlayer.style="width:100%;height:420px;border-radius:14px;background:#000";

const overlay=document.createElement("button");
overlay.id="playOverlay";
overlay.textContent="▶";
overlay.style=`
position:absolute;
inset:0;
margin:auto;
width:80px;
height:80px;
border-radius:50%;
border:none;
font-size:26px;
background:linear-gradient(135deg,#3b82f6,#2563eb);
color:#fff;
cursor:pointer;
`;

wrap.innerHTML="";
wrap.appendChild(newPlayer);
wrap.appendChild(overlay);

player=newPlayer;

overlay.onclick=()=>player.play();
player.onpause=()=>overlay.style.display="block";
player.onplay=()=>overlay.style.display="none";
player.onended=()=>overlay.style.display="block";
}

function playVideo(url){

createOverlayPlayer();

if(url.includes("streamtape.com")){
const m=url.match(/\/v\/([^\/]+)/);
if(m) url="https://streamtape.com/get_video?id="+m[1];
}

if(url.includes("videy.co")){
const m=url.match(/id=([^&]+)/);
if(m) url="https://cdn.videy.co/"+m[1]+".mp4";
}

if(!url.includes(".mp4") && !url.includes("get_video")){
const wrap=document.getElementById('videoWrap');
const iframe=document.createElement("iframe");
iframe.src=url;
iframe.allowFullscreen=true;
iframe.style="width:100%;height:420px;border:none;border-radius:14px";
wrap.innerHTML="";
wrap.appendChild(iframe);
return;
}

player.src=url;
}

fetch('/videos').then(r=>r.json()).then(videos=>{
if(!id||!videos[id])return;
const v=videos[id];

app.classList.remove('hidden');
title.textContent=v.title;

playVideo(v.src);

rewind.onclick=()=>player.currentTime-=5;
forward.onclick=()=>player.currentTime+=5;
fs.onclick=()=>!document.fullscreenElement?player.requestFullscreen():document.exitFullscreen();
speed.onchange=e=>player.playbackRate=parseFloat(e.target.value);
});

/* ===== IKLAN WAJIB 3x SEBELUM PLAY VIDEO ===== */
(function(){
let adCount = 0;
const MAX_AD = 3;

function handleVideoClick(e){
const wrap=document.getElementById('videoWrap');
if(!wrap) return;
if(!wrap.contains(e.target)) return;

if(adCount < MAX_AD){
e.preventDefault();
e.stopPropagation();
window.open('https://omg10.com/4/9707196','_blank');
adCount++;
return false;
}

document.removeEventListener('click', handleVideoClick, true);
}

document.addEventListener('click', handleVideoClick, true);
})();
</script>

<!-- POPUNDER ZONE (script kamu) -->
<script>
(function(s){
s.dataset.zone='9713245';
s.src='https://al5sm.com/tag.min.js';
})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')));
</script>

</body>
</html>
