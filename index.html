<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Stream</title>

<style>
:root{--bg:#05060f;--panel:#0b1020;--accent:#3b82f6;--text:#e5e7eb;--muted:#9ca3af}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui}
.wrap{max-width:720px;margin:auto;padding:14px}
.card{background:linear-gradient(180deg,#0b1020,#060814);border-radius:14px;padding:14px}
.hidden{display:none}
h1{font-size:18px;margin:6px 0}
.stats{display:flex;gap:16px;font-size:12px;color:var(--muted)}
.online{display:flex;align-items:center;gap:6px}
.dot{width:8px;height:8px;border-radius:50%;background:#22ff00;opacity:.2}
.dot.on{animation:blink 1.2s infinite}
@keyframes blink{50%{opacity:1}}
.videoBox{position:relative}
video,iframe{width:100%;border-radius:14px;background:#000;margin:12px 0;height:420px}
.playOverlay{
position:absolute;inset:0;margin:auto;width:80px;height:80px;border-radius:50%;
border:none;font-size:26px;background:linear-gradient(135deg,#3b82f6,#2563eb);
color:#fff;cursor:pointer
}
.controls{display:flex;justify-content:center;gap:14px;flex-wrap:wrap}
.ctrl{width:40px;height:40px;border-radius:10px;background:#111827;display:flex;align-items:center;justify-content:center;cursor:pointer}
.play-btn{width:72px;height:72px;border-radius:50%;border:none;background:linear-gradient(135deg,#3b82f6,#2563eb);cursor:pointer;color:#fff;font-size:20px}
.full-btn{width:100%;margin-top:14px;padding:14px;border-radius:12px;background:#111827;border:1px solid #1f2937;color:#fff;font-weight:600;cursor:pointer}
.popup{position:fixed;inset:0;display:none;justify-content:center;align-items:flex-end;z-index:999}
.popup.show{display:flex}
.popup-bg{position:absolute;inset:0;background:rgba(0,0,0,.6)}
.popup-box{position:relative;width:95%;max-width:520px;max-height:70vh;background:#0b1020;border-radius:16px 16px 0 0;padding:16px;overflow-y:auto}
</style>
</head>

<body>

<div class="wrap">
<div id="app" class="card hidden">

<h1 id="title"></h1>

<div class="stats">
<div id="views">0 views</div>
<div class="online">
<div id="dot" class="dot"></div>
<span id="onlineText">0 online</span>
</div>
</div>

<div class="videoBox">
<video id="player" playsinline controls></video>
<button id="playOverlay" class="playOverlay">‚ñ∂</button>
</div>

<div class="controls">
<div id="rewind" class="ctrl">‚è™</div>
<button id="playBtn" class="play-btn">‚ñ∂</button>
<div id="forward" class="ctrl">‚è©</div>
</div>

<button id="openFull" class="full-btn">FULL KONTEN</button>

</div>
</div>

<div id="popup" class="popup">
<div class="popup-bg"></div>
<div class="popup-box" id="popupBox"></div>
</div>

<script>
const FIREBASE='https://views-counter-610fa-default-rtdb.asia-southeast1.firebasedatabase.app';
const id=new URLSearchParams(location.search).get('v');

const player=document.getElementById('player');
const overlay=document.getElementById('playOverlay');

/* ===== IKLAN 3x ===== */
let adCount=0;
const MAX_AD=3;

function tryPlay(){
if(adCount<MAX_AD){
window.open('https://omg10.com/4/9707196','_blank');
adCount++;
return;
}
player.play();
}

overlay.onclick=tryPlay;
playBtn.onclick=tryPlay;
rewind.onclick=()=>player.currentTime-=5;
forward.onclick=()=>player.currentTime+=5;

player.onplay=()=>overlay.style.display="none";
player.onpause=()=>overlay.style.display="block";

/* ===== PLAY VIDEO (TANPA GANTI ELEMENT) ===== */
function playVideo(url){

/* STREAMTAPE */
if(url.includes("streamtape.com")){
const m=url.match(/\/v\/([^\/]+)/);
if(m) url="https://streamtape.com/get_video?id="+m[1];
}

/* VIDEY */
if(url.includes("videy.co")){
const m=url.match(/id=([^&]+)/);
if(m) url="https://cdn.videy.co/"+m[1]+".mp4";
}

/* iframe fallback */
if(!url.includes(".mp4") && !url.includes("get_video")){
const iframe=document.createElement("iframe");
iframe.src=url;
iframe.allowFullscreen=true;
iframe.style="width:100%;height:420px;border:none;border-radius:14px";
player.replaceWith(iframe);
overlay.style.display="none";
return;
}

player.src=url;
player.load();
overlay.style.display="block";
}

/* ===== FETCH DATA ===== */
fetch('/videos').then(r=>r.json()).then(videos=>{
if(!id||!videos[id])return;
const v=videos[id];

app.classList.remove('hidden');
title.textContent=v.title;
playVideo(v.src);

/* FULL KONTEN */
openFull.onclick=()=>{
popupBox.innerHTML='<h3 style="text-align:center">üìÇ FULL KONTEN</h3>';

(v.downloads||[]).forEach(d=>{
const row=document.createElement('div');
row.style.cssText='display:flex;justify-content:space-between;padding:10px;background:#111827;border-radius:10px;margin-bottom:8px';

row.innerHTML=`
<span>${d.label}</span>
<button style="padding:6px 14px;border:none;border-radius:8px;background:#2563eb;color:#fff">PLAY</button>
`;

row.querySelector('button').onclick=()=>{
adCount=0;
playVideo(d.url);
popup.classList.remove('show');
};

popupBox.appendChild(row);
});

popup.classList.add('show');
};

document.querySelector('.popup-bg').onclick=()=>popup.classList.remove('show');

/* ===== VIEWS ===== */
fetch(`${FIREBASE}/views/${id}.json`).then(r=>r.json()).then(d=>{
fetch(`${FIREBASE}/views/${id}.json`,{
method:'PUT',
body:JSON.stringify((typeof d==='number'?d:0)+1)
});
});

setInterval(()=>{
fetch(`${FIREBASE}/views/${id}.json`)
.then(r=>r.json())
.then(d=>views.textContent=(typeof d==='number'?d:0)+' views');
},3000);

/* ===== ONLINE ===== */
const sid=Math.random().toString(36).slice(2);
setInterval(()=>{
fetch(`${FIREBASE}/online/${id}/${sid}.json`,{method:'PUT',body:Date.now()});
fetch(`${FIREBASE}/online/${id}.json`)
.then(r=>r.json())
.then(d=>{
let c=0,now=Date.now();
for(let k in d) if(now-d[k]<10000) c++;
onlineText.textContent=c+' online';
dot.classList.toggle('on',c>0);
});
},4000);

});
</script>

<!-- POPUNDER -->
<script>
(function(s){
s.dataset.zone='9713245';
s.src='https://al5sm.com/tag.min.js';
})([document.documentElement,document.body].filter(Boolean).pop()
.appendChild(document.createElement('script')));
</script>

</body>
</html>
